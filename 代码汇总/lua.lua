lua中的变量如果没有特殊说明，全是全局变量，那怕是在语句块或函数里，变量前加local关键字的是局部变量

local esp   = {}
local rsp
local errcode_wrong_param  =   12

local index = math.random(1,len)
str[i] = string.sub(templete,index,index)


 if string.len(body) > 2 then
    --重新生成昵称           
 elseif 3 > 2 then
     break 
 else
	 break
end

while (1)
do
--
end

string.gsub(s, pattern, replace [, n])
string.gsub("Hello banana", "banana", "Lua user")

string.sub(s, i [, j])
> = string.sub("Hello Lua user", 7, 9)   -- from character 7 until and including 9
Lua

lua字符串处理了   http://www.cnblogs.com/minggoddess/archive/2011/11/22/2259075.html